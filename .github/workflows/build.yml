name: Build Windows Exe

on:
  push:
    tags:
      - 'v*' # 当你推送标签（如 v1.0）时触发
  workflow_dispatch: # 允许你手动点击按钮触发

jobs:
  build-windows:
    runs-on: windows-latest # 关键点：向 GitHub 申请一台 Windows 电脑

    steps:
      - uses: actions/checkout@v4  # 更新到v4

      - name: Set up Python
        uses: actions/setup-python@v5  # 更新到v5
        with:
          python-version: '3.10' # 建议用稳定版本

      - name: Install Dependencies
        run: |
          pip install uv
          uv pip install flet pyinstaller --system
        env:
          PYTHONIOENCODING: utf-8
          LANG: en_US.UTF-8

      - name: Build with Flet
        # Flet 自带的打包命令，比直接用 pyinstaller 更适合 flet 项目
        run: |
          chcp 65001
          $env:PYTHONIOENCODING="utf-8"
          flet pack csv_tool.py --name "CSV_Split_Tool" --icon "logo.ico"
        env:
          PYTHONIOENCODING: utf-8
          LANG: en_US.UTF-8
        shell: powershell

      - name: Upload Artifact
        uses: actions/upload-artifact@v4  # 更新到v4
        with:
          name: windows-exe-file
          path: dist/*.exe